{
  "type": "VerticalLayout", 
   "actions":[
    {
      "scope": "#/properties/count",
      "kind": "calc",
      "behavior": ["on-change", "on-init"],
      "script": "return filtered_employees && filtered_employees.length;",
      "depends": ["#/properties/filtered_employees"]
    },
    {
      "scope": "#/properties/employees",
      "kind": "rest",
      "behavior": "on-init",
      "method": "get",
      "url": "http://localhost:3001/employees",
      "mapResponseScript": "response.forEach(e=> e.id = parseInt(e.id)); return response;"
    },
    {
      "id": "upper-filter",
      "scope": "#/properties/upper_filter",
      "kind": "calc",
      "behavior": "on-change",
      "script": "return filter && filter.toUpperCase();",
      "depends": ["#/properties/filter"]
    },
    
    {
      "id": "filter-employees",
      "scope": "#/properties/filtered_employees",
      "kind": "calc",
      "behavior": ["on-change", "on-init"],
      "script": "return employees.filter(e=>filter === undefined || filter === '' || e.name?.includes(filter) || e.surname?.includes(filter));",
      "depends": ["#/properties/employees", "#/properties/filter"]
    },
    {
      "id": "employees-changed",
      "kind": "rise-event-on-array-change",
      "behavior": ["on-change"],
      "events": ["delete"],
      "depends": ["#/properties/employees"]
    },
    {
      "id": "update-employees",
      "kind": "rest",
      "behavior": ["on-event"],
      "eventPattern": "employees-changed/delete/{id}",
      "url": "http://localhost:3001/employees/{id}",
      "method": "delete"
    }

  ],
  "elements": [
    {
      "type": "VerticalLayout",
      "elements": [
        {
          "type": "HorizontalLayout",
          "elements": [
            {
              "type": "Control",
              "scope": "#/properties/refresh",
              "options": {
                "refresh": true,
                "actionScopes": [
                  "#/properties/employees",
                  "#/properties/filtered_employees"
                ]
              }
            },
            {
              "type": "Control",
              "label": "Seacrh by name",
              "scope": "#/properties/filter"
            }
          ]
        },
        {
          "type": "Control",
          "scope": "#/properties/employees",
          "options":{
            "readonly": false
          }
        },
        {
          "type": "Control",
          "scope": "#/properties/all_employees",
          "label": "All employees",
          "options":{
            "readonly": true
          }
        },
        {
          "type": "Control",
          "scope": "#/properties/filtered_employees"
        },
        {
          "type": "Control",
          "label": "Upper case filter",
          "scope": "#/properties/upper_filter",
          "options": {
            "readonly": true
          }
        },
        {
          "type": "Control",
          "label": "Total employees",
          "scope": "#/properties/count",
          "options": {
            "readonly": true
          }
        },
        {
          "type": "Control",
          "label": "",
          "scope": "#/properties/countX2",
          "options": {
            "readonly": true
          }
        }
      ]
    }
  ]
}
